import{r as d,q as R,j as t,Y as V,b as u,y as h}from"./app-DG4lkm6I.js";import{A as I}from"./AuthenticatedLayout-DihFFGMg.js";import{B as z,S as H,P as q}from"./Pagination-EgFfowgk.js";import j from"./CapaianForm-Cpd99Ll-.js";import{d as b}from"./dayjs.min-D2B25P1N.js";import{u as x,w as Q}from"./xlsx-YQvpTstd.js";import W from"./TableCapaian-DW8AB48B.js";import{F as C}from"./index-bg-KSOeg.js";import{s as G}from"./index-Cw_285zN.js";import"./Header-CS4FZP7E.js";import"./index-Cd_0zI_X.js";import"./index-BOoDnPea.js";import"./PurePanel-X1WZuywX.js";import"./compact-item-CWVgPv4E.js";import"./zoom-CYFUwcOb.js";import"./index-DPovuAtR.js";import"./index-CdRAOwz7.js";import"./index-CQGu2i8L.js";import"./index-C85wRqGF.js";import"./useLocale-Bn5sQBMJ.js";import"./button-B7yed1Qm.js";import"./index-CP26vVl7.js";import"./ActionButton-BmFTjVmE.js";import"./useForceUpdate-BAS2dfvj.js";import"./index-jsO2WCLV.js";import"./TextArea-Q31wMMF0.js";import"./BaseInput-QhogEnYX.js";import"./index-DXcwbtgN.js";import"./index-CPNKc2Cg.js";import"./row-B-yTj_Is.js";const Pe=({auth:s,capaian:r,search:p,jabatan:M,unitKerja:_})=>{const[y]=C.useForm(),[v]=C.useForm(),[n,P]=G.useMessage(),[S,f]=d.useState(!1),[F,m]=d.useState(!1),[o,D]=d.useState(null),{errors:k,flash:g}=R().props,Y=()=>f(!0),E=()=>f(!1),A=e=>{D(e),m(!0)},L=()=>m(!1),O=async e=>{try{n.open({key:"submit-form",type:"loading",content:"menghapus 1 capaian..."});const a=await u.delete(`/capaian/${e}`);n.open({key:"submit-form",type:"success",content:"1 capaian berhasil terhapus"}),m(!1)}catch{n.open({key:"submit-form",type:"error",content:"terjadi kesalahan server"})}finally{h.get("/singkat/kelola-ckp",{search:p},{preserveState:!0})}},T=e=>{const a=new URL("http://localhost:8000/singkat/kelola-ckp");a.searchParams.set("search",e),h.get(a,{replace:!0})},U=async e=>{try{n.open({key:"submit-form",type:"loading",content:"menyimpan capaian pegawai"});let a=e.bulan[0],i=e.bulan[1];e.bulan_mulai=new Date(a).getMonth()+1,e.bulan_akhir=new Date(i).getMonth()+1,e.tahun=new Date(e.tahun).getFullYear(),delete e.bulan;const l=await u.post(`/capaian/${e.id}`,e,{headers:{"Content-Type":"multipart/form-data"}});n.open({key:"submit-form",type:"success",content:"perubahan telah disimpan"}),m(!1)}catch(a){console.log({error:a}),n.open({key:"submit-form",type:"error",content:a.response.data.error})}finally{h.get("/singkat/kelola-ckp",{search:p},{preserveState:!0})}},K=async e=>{let a=e.bulan[0],i=e.bulan[1];e.bulan_mulai=new Date(a).getMonth()+1,e.bulan_akhir=new Date(i).getMonth()+1,e.tahun=new Date(e.tahun).getFullYear(),delete e.bulan;try{n.open({key:"add-form",type:"loading",content:"menambahkan capaian pegawai"});const l=await u.post("/capaian",e,{headers:{"Content-Type":"multipart/form-data"}});n.open({key:"add-form",type:"success",content:"perubahan telah disimpan"})}catch(l){console.log({error:l}),n.open({key:"add-form",type:"error",content:l.response.data.message})}finally{h.get("/singkat/kelola-ckp",{search:p},{preserveState:!0}),f(!1)}},$=async e=>{const{data:a}=await u.get(route("kelola-ckp.fetch",{search:e})),i=x.book_new(),l=x.json_to_sheet(a);x.book_append_sheet(i,l,"capaian");const B=Q(i,{bookType:"xlsx",type:"array"}),N=new Blob([B],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),w=URL.createObjectURL(N),c=document.createElement("a");c.href=w,c.download="data_capaian.xlsx",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(w),setOpenUnduhModal(!1)};return d.useEffect(()=>{if(!o)return;let e={...o};e.tahun=b(new Date(`${o.tahun}-01-01`)),e.bulan=[b(`${o.tahun}-${o.bulan_mulai}`,"YYYY-M"),b(`${o.tahun}-${o.bulan_akhir}`,"YYYY-M")],y.setFieldsValue(e)},[o]),t.jsxs(I,{user:s.user,children:[P,g.success&&t.jsx(Alert,{tipe:"success",pesan:g.success}),k&&Object.keys(k).length>0&&t.jsx(Alert,{tipe:"error",pesan:"Terjadi kesalahan! Silahkan cek form."}),t.jsx(V,{title:s.user.role=="viewer"?"CKP":"Kelola CKP"}),t.jsx(z,{pageName:s.user.role=="viewer"?"CKP":"Kelola CKP"}),t.jsxs("div",{className:"flex flex-row sm:justify-between mb-5",children:[t.jsx(H,{initialQuery:p,handleSearch:T}),t.jsxs("div",{children:[t.jsxs("button",{onClick:()=>$(p),type:"button",className:"inline-flex items-center justify-center gap-2.5 rounded-md bg-primary py-2 px-5 text-center font-medium text-white hover:bg-opacity-90 lg:px-8 xl:px-5 mr-4",children:[t.jsx("span",{children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"size-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})})}),"Unduh Data"]}),["operator"].includes(s.user.role)&&t.jsxs("button",{onClick:Y,className:" gap-2.5 rounded-md    inline-flex items-center justify-center bg-meta-3 py-2 px-5  text-center font-medium text-white hover:bg-opacity-90 lg:px-8 xl:px-5 mr-4",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:t.jsx("path",{fill:"currentColor",d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"})}),"Tambah capaian"]})]})]}),t.jsxs("div",{className:"flex flex-col gap-10",children:[t.jsx(W,{capaian:r,onEdit:A,onDelete:O,role:s.user.role}),t.jsx(q,{links:r.links,currentPage:r.current_page,lastPage:r.last_page,total:r.total,from:r.from,to:r.to})]}),t.jsx(j,{jabatan:M,onFinish:K,form:v,unitKerja:_,visible:S,onCancel:E,role:s.user.role,type:"daftar",title:"Tambah Capaian Pegawai"}),t.jsx(j,{visible:F,onCancel:L,capaian:o,onFinish:U,form:y,title:"Ubah Capaian Pegawai",okText:"Simpan",type:"edit",initPeriod:o?o.periode:""})]})};export{Pe as default};
