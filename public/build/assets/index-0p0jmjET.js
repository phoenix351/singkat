import{r as p,q as L,j as e,Y as B,y as n}from"./app-BGp6Cjwo.js";import{A as U}from"./AuthenticatedLayout-BR4zXvB2.js";import{B as V,S as Y,P as R}from"./Pagination-CBwXTU3a.js";import q from"./ExportModal-CWlnUySH.js";import z from"./TableCapaian-Bjq1Yozs.js";import y from"./CapaianForm-CJKTYkYr.js";import{d as H}from"./dayjs.min-DH2lWygO.js";import{F as g}from"./index-BtE96evI.js";import{s as Q}from"./index-CVf5FA5V.js";import"./index-b5Y3fyma.js";import"./index-WmajGb9C.js";import"./zoom-X00PKVfC.js";import"./motion-B8OS_XYX.js";import"./PurePanel-BCMIoBXA.js";import"./useLocale-CAzkx_sE.js";import"./index-DfVeC_1A.js";import"./row-USzwBVrA.js";import"./index-CZsqTT0k.js";import"./index-Fg_hPEis.js";import"./index-FMfpcoE3.js";import"./index-B-Iu5HGJ.js";import"./index-zm8AfkF_.js";import"./index-B12D2l46.js";import"./BaseInput-BO8apeIw.js";import"./SearchOutlined-DBFYwasW.js";import"./index-BrLnm6_L.js";import"./index-B1wf3RrR.js";const we=({auth:o,capaian:r,search:k,jabatan:j,unitKerja:b})=>{const[u]=g.useForm(),[w]=g.useForm(),[s,C]=Q.useMessage(),[M,c]=p.useState(!1),[v,m]=p.useState(!1),[l,S]=p.useState(null),[E,h]=p.useState(!1),{errors:x,flash:f}=L().props,F=()=>c(!0),P=()=>c(!1),A=()=>h(!0),K=()=>h(!1),T=t=>{S(t),m(!0)},O=()=>m(!1),D=t=>{n.delete(`/kelola-ckp/${t}`).then(()=>{})},N=t=>{const a=new URL("http://localhost:8000/kelola-ckp");a.searchParams.set("search",t),n.get(a,{replace:!0})},_=async t=>{try{s.open({key:"submit-form",type:"loading",content:"menyimpan capaian pegawai"});let d=`${new Date(t.tahun).getFullYear()}`;const i={...t};i.tahun=d;const I=await axios.patch(`/capaian/${t.id}`,i,{headers:{"Content-Type":"application/json"}});s.open({key:"submit-form",type:"success",content:"perubahan telah disimpan"}),n.get("/kelola-ckp",{},{preserveState:!0}),m(!1)}catch(a){s.open({key:"submit-form",type:"error",content:a.response.data.error})}finally{n.get("/kelola-ckp",{},{preserveState:!0})}},$=async t=>{try{s.open({key:"add-form",type:"loading",content:"menambahkan capaian pegawai"});let d=`${new Date(t.tahun).getFullYear()}`;const i={...t};i.tahun=d;const I=await axios.post("/capaian",i,{headers:{"Content-Type":"application/json"}});s.open({key:"add-form",type:"success",content:"perubahan telah disimpan"}),n.get("/kelola-ckp",{},{preserveState:!0})}catch(a){s.open({key:"add-form",type:"error",content:a.response.data.error})}finally{n.get("/kelola-ckp",{},{preserveState:!0}),c(!1)}};return p.useEffect(()=>{if(!l)return;let t={...l};console.log({capaian:t}),t.tahun=H(new Date(`${l.tahun}-01-01`)),u.setFieldsValue(t)},[l]),e.jsxs(U,{user:o.user,children:[C,f.success&&e.jsx(Alert,{tipe:"success",pesan:f.success}),x&&Object.keys(x).length>0&&e.jsx(Alert,{tipe:"error",pesan:"Terjadi kesalahan! Silahkan cek form."}),e.jsx(B,{title:o.user.role=="viewer"?"CKP":"Kelola CKP"}),e.jsx(V,{pageName:o.user.role=="viewer"?"CKP":"Kelola CKP"}),e.jsxs("div",{className:"flex flex-row sm:justify-between mb-5",children:[e.jsx(Y,{initialQuery:k,handleSearch:N}),e.jsxs("div",{children:[e.jsxs("button",{onClick:A,type:"button",className:"inline-flex items-center justify-center gap-2.5 rounded-md bg-primary py-2 px-5 text-center font-medium text-white hover:bg-opacity-90 lg:px-8 xl:px-5 mr-4",children:[e.jsx("span",{children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"size-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})})}),"Unduh Data"]}),(o.user.role==="admin"||o.user.role==="super admin")&&e.jsx("button",{onClick:F,className:" gap-2.5 rounded-md    inline-flex items-center justify-center bg-meta-3 py-2 px-5  text-center font-medium text-white hover:bg-opacity-90 lg:px-8 xl:px-5 mr-4",children:"Tambah capaian"})]})]}),e.jsxs("div",{className:"flex flex-col gap-10",children:[e.jsx(z,{capaian:r,onEdit:T,onDelete:D,role:o.user.role}),e.jsx(R,{links:r.links,currentPage:r.current_page,lastPage:r.last_page,total:r.total,from:r.from,to:r.to})]}),e.jsx(y,{jabatan:j,onFinish:$,form:w,unitKerja:b,visible:M,onCancel:P,role:o.user.role,type:"daftar"}),e.jsx(y,{visible:v,onCancel:O,capaian:l,onFinish:_,form:u,title:"Ubah CKP",okText:"Simpan",type:"edit"}),e.jsx(q,{visible:E,onCancel:K})]})};export{we as default};
