import{r as l,a as c,j as e}from"./app-qozg50Md.js";import{F as r}from"./index-aOYu-vQh.js";import{M as y}from"./index-BSk5wdO_.js";import{I as h}from"./index-DC3t1Uft.js";import{S as b}from"./index-DTsYXN2-.js";import{T as j}from"./index-DZ7bMjgQ.js";import"./PurePanel-CDwIu1rJ.js";import"./warning-Bf_VSDRp.js";import"./AntdIcon-oE3BgIqN.js";import"./index-Cl5Xqjrl.js";import"./button-Bf_he-TK.js";import"./zoom-DM4q-JEj.js";import"./row-D3mj2rtc.js";import"./index-CJyQPicH.js";import"./useLocale-BH1iDomU.js";import"./ActionButton-CVruMRtK.js";import"./EyeOutlined-BduE5REH.js";import"./index-B-kb_xka.js";import"./DownOutlined-DKhpsX0H.js";const H=({visible:f,onCancel:k,handleSave:x,abk:o,jabatan:g,unitKerja:_,role:d})=>{const[i]=r.useForm(),[E,F]=l.useState([]),[S,K]=l.useState(null);l.useEffect(()=>{o&&(i.setFieldsValue(o),o.unit_kerja_id&&p(o.unit_kerja_id,o.jabatan_id))},[o,i]),l.useEffect(()=>{async function t(){try{const{data:a}=await c.get(route("api.token.csrf"));i.setFieldValue("_token",a)}catch{console.log("error get token")}}t()},[]);const w=(t,a)=>{const n=i.getFieldValue("abk");return a>=0&&a<=n?Promise.resolve():Promise.reject(new Error("Nilai Eksisting tidak boleh lebih dari nilai ABK!"))},p=async(t,a=null)=>{K(t);try{let m=(await c.get(route("index")+"/api/get-available-jabatan",{params:{unit_kerja_id:t}})).data.map(s=>({value:s.id,label:s.nama}));if(a){const s=g.find(u=>u.id===a);s&&!m.some(u=>u.value===a)&&m.push({value:s.id,label:s.nama})}F(m)}catch(n){console.error("Failed to fetch jabatan:",n)}};return e.jsx(y,{title:"Edit ABK",open:f,onCancel:k,onOk:()=>i.submit(),width:600,okText:"Simpan",cancelText:"Batal",children:e.jsxs(r,{form:i,name:"control-hooks",onFinish:x,onKeyDown:t=>{t.code==="Enter"&&i.submit()},style:{maxWidth:600},layout:"vertical",wrapperCol:{span:24},autoComplete:"off",size:"large",children:[e.jsx(r.Item,{name:"_token",hidden:!0,children:e.jsx(h,{})}),e.jsx(r.Item,{name:"id",hidden:!0,children:e.jsx(h,{})}),e.jsx(r.Item,{name:"unit_kerja_id",label:"Unit Kerja",rules:[{required:!0,message:"Unit Kerja tidak boleh kosong."}],children:e.jsx(b,{...d==="admin"?{}:{disabled:!0},placeholder:"Pilih Unit Kerja",showSearch:!0,optionFilterProp:"label",onChange:t=>p(t),options:_.map(t=>({value:t.id,label:t.nama}))})}),e.jsx(r.Item,{name:"jabatan_id",label:"Nama Jabatan",rules:[{required:!0,message:"Jabatan tidak boleh kosong."}],children:e.jsx(b,{...d==="admin"?{}:{disabled:!0},placeholder:"Pilih Jabatan",showSearch:!0,optionFilterProp:"label",options:E})}),e.jsx(r.Item,{name:"abk",label:"ABK",rules:[{required:!0,message:"ABK tidak boleh kosong."}],children:e.jsx(j,{...d==="admin"?{}:{disabled:!0},className:"border w-full border-slate-400 rounded-md"})}),e.jsx(r.Item,{rules:[{validator:w}],name:"eksisting",label:"Eksisting",children:e.jsx(j,{className:"border w-full border-slate-400 rounded-md"})})]})})};export{H as default};
