import{r as j,q as z,j as e,Y as H,y as N}from"./app-DFnwsWrs.js";import{A as Q}from"./AuthenticatedLayout-DXhdXRqs.js";import{B as W}from"./Breadcrumb-DJhJcPHU.js";import{S as Y,P as G}from"./Pagination-iqAnRRKE.js";import X from"./TableABK-Df_FY2Ic.js";import Z from"./AddAbkForm-SxChgXRk.js";import $ from"./EditAbkForm-DE9S3W5l.js";import{A as d}from"./Alert-xSoEkZKj.js";import{u as x,w as ee}from"./xlsx-YQvpTstd.js";import"./Header-CPa2CG7Q.js";import"./index-BbNNQxMk.js";import"./index-7Nr_NS3U.js";import"./zoom-B0W9qZb7.js";import"./button-Bz9USzm7.js";import"./index-noO_gH--.js";import"./ActionButton-CtM_w2vP.js";import"./useLocale-Bol56ME6.js";import"./index-BZT0KOT1.js";import"./index-D6qsxmpK.js";import"./PurePanel-CRgtzXFw.js";import"./BaseInput-DmJDSday.js";import"./row-PkYKM1PI.js";import"./index-CxLqXYg-.js";import"./index-CdkzHvRD.js";import"./DownOutlined-N7VHuyP1.js";import"./index-zPBp9yDv.js";const Ke=({auth:l,abk:n,search:b,jabatan:g,unitKerja:_})=>{const[E,w]=j.useState(!1),[O,y]=j.useState(!1),[C,R]=j.useState(null),{errors:o,flash:A}=z().props,U=()=>w(!0),L=()=>w(!1),S=()=>y(!1),D=i=>{R(i),y(!0)},P=i=>{N.delete(route("singkat.admin.abk.destroy",{abk:i})).then(()=>{})},J=async i=>{const{data:I}=await axios.get(route("singkat.admin.abk.fetch",{search:i})),v=I.reduce((s,r)=>{const a=r.nomor_urut_kepka;return s[a]||(s[a]=[]),s[a].push(r),s},{}),f={},B=[];for(let s of Object.keys(v)){let r=v[s];r.sort((t,k)=>t.unit_kerja_id-k.unit_kerja_id);let a=[r[0].nomor_urut_kepka,r[0].jabatan];r.forEach(t=>{f[t.unit_kerja_id]||(f[t.unit_kerja_id]=t.unit_kerja),a.push(t.abk,t.eksisting,t.kebutuhan_pegawai)}),B.push(a)}const K=x.book_new(),m={};let u=[["No","Nama Jabatan"],["No","Nama Jabatan"],["No","Nama Jabatan"]],h=[{s:{r:0,c:0},e:{r:2,c:0}},{s:{r:0,c:1},e:{r:2,c:1}}],c=0;for(let s of Object.values(f)){const r=[s,"",""],a={s:{r:0,c:c+2},e:{r:0,c:c+4}},t=["KEPKA 182 TAHUN 2024","",""],k={s:{r:1,c:c+2},e:{r:1,c:c+4}},q=["ABK","Eksisting","Kebutuhan Pegawai"];u[0].push(...r),u[1].push(...t),u[2].push(...q),h.push(a),h.push(k),c=c+3}m["!merges"]=h,x.sheet_add_aoa(m,u),x.sheet_add_aoa(m,B,{origin:-1}),x.book_append_sheet(K,m,"abk");const V=ee(K,{bookType:"xlsx",type:"array"}),F=new Blob([V],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),M=URL.createObjectURL(F),p=document.createElement("a");p.href=M,p.download="data_abk.xlsx",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(M),setOpenUnduhModal(!1)},T=i=>{N.get(route("singkat.admin.abk"),{search:i},{replace:!0})};return e.jsxs(Q,{title:"User",user:l.user,children:[A.success&&e.jsx(d,{tipe:"success",pesan:A.success}),o.abk&&e.jsx(d,{tipe:"error",pesan:o.abk}),o.jabatan&&e.jsx(d,{tipe:"error",pesan:o.jabatan}),o.unit_kerja&&e.jsx(d,{tipe:"error",pesan:o.unit_kerja}),o.eksisting&&e.jsx(d,{tipe:"error",pesan:o.eksisting}),e.jsx(H,{title:l.user.role=="viewer"?"ABK":"Kelola ABK"}),e.jsx(W,{pageName:l.user.role=="viewer"?"ABK":"Kelola ABK"}),e.jsxs("div",{className:"flex flex-row sm:justify-between mb-5",children:[e.jsx(Y,{initialQuery:b,handleSearch:T}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>J(b),type:"button",className:"inline-flex items-center justify-center gap-2.5 rounded-md bg-primary py-2 px-5 text-center font-medium text-white hover:bg-opacity-90 lg:px-8 xl:px-5 mr-4",children:[e.jsx("span",{children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"size-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})})}),"Unduh Data"]}),["operator"].includes(l.user.role)&&e.jsx("button",{onClick:U,className:" gap-2.5 rounded-md    inline-flex items-center justify-center bg-meta-3 py-2 px-5  text-center font-medium text-white hover:bg-opacity-90 lg:px-8 xl:px-5 mr-4",children:"Tambah ABK"})]})]}),e.jsxs("div",{className:"flex flex-col gap-10",children:[e.jsx(X,{abk:n,onEdit:D,onDelete:P,role:l.user.role}),e.jsx(G,{links:n.links,currentPage:n.current_page,lastPage:n.last_page,from:n.from,to:n.to,total:n.total})]}),e.jsx(Z,{visible:E,onCancel:L,jabatan:g,unitKerja:_}),e.jsx($,{visible:O,onCancel:S,abk:C,jabatan:g,unitKerja:_,role:l.user.role})]})};export{Ke as default};
