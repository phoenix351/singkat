import{r as _,q as X,j as e,Y as Z,y as k}from"./app-BCXNxsvu.js";import{A as $}from"./AuthenticatedLayout-DaLId21e.js";import{B as ee}from"./Breadcrumb-B3vwvP4h.js";import{S as te,P as re}from"./Pagination-BOyw80Bh.js";import oe from"./TableABK-YCXDICab.js";import se from"./AddAbkForm-DZfwY4Mc.js";import ae from"./EditAbkForm-C-46hEjg.js";import{A as u}from"./Alert-Dfw58u0m.js";import{u as b,w as ne}from"./xlsx-YQvpTstd.js";import{F as ie}from"./index-CeOsWrVz.js";import{s as le}from"./index-CuqvQYHX.js";import"./Header-Bjuoj23p.js";import"./index-Ctvgr8PY.js";import"./index-jkWDoZuv.js";import"./zoom-Dv1Wj_dI.js";import"./button-DYp94kPC.js";import"./index-BC_RW6ls.js";import"./ActionButton-BA_aWDSj.js";import"./useLocale-BdT_xuzA.js";import"./index-CqUmIfNG.js";import"./index-DqBy_bOg.js";import"./PurePanel-BvOf297_.js";import"./index-CCBrNHrs.js";import"./index-DT3GEK5Q.js";import"./DownOutlined-DM4bYnaF.js";import"./index-Xv2Eix1U.js";import"./row-DByOmR57.js";const C="application/json",Le=({auth:c,abk:i,search:w,jabatan:v,unitKerja:A})=>{const[O,B]=_.useState(!1),[R,h]=_.useState(!1),[U,L]=_.useState(null),[T]=ie.useForm(),[p,D]=le.useMessage(),{errors:s,flash:K}=X().props,F=()=>B(!0),P=()=>B(!1),J=()=>h(!1),I=t=>{L(t),h(!0)},V=async t=>{try{p.open({key:"create-form",type:"loading",content:"menyimpan perubahan..."});const l=await axios.post(route("singkat.admin.abk.store"),t,{headers:{"Content-Type":C}});p.open({key:"create-form",type:"success",content:"perubahan telah disimpan"}),h(!1)}catch(l){console.log(l),p.open({key:"create-form",type:"error",content:"terjadi error, hubungi pengembang..."})}finally{k.reload({preserveState:!0,preserveScroll:!0})}},H=async t=>{try{p.open({key:"save-form",type:"loading",content:"menyimpan perubahan..."});const l=await axios.put(route("singkat.admin.abk.update",{abk:t.id}),t,{headers:{"Content-Type":C}});p.open({key:"save-form",type:"success",content:"perubahan telah disimpan"}),h(!1)}catch(l){console.log(l),p.open({key:"save-form",type:"error",content:"terjadi error, hubungi pengembang..."})}finally{k.reload({preserveState:!0,preserveScroll:!0})}},q=t=>{k.delete(route("singkat.admin.abk.destroy",{abk:t})).then(()=>{})},z=async t=>{const{data:l}=await axios.get(route("singkat.admin.abk.fetch",{search:t})),M=l.reduce((a,o)=>{const n=o.nomor_urut_kepka;return a[n]||(a[n]=[]),a[n].push(o),a},{}),g={},N=[];for(let a of Object.keys(M)){let o=M[a];o.sort((r,j)=>r.unit_kerja_id-j.unit_kerja_id);let n=[o[0].nomor_urut_kepka,o[0].jabatan];o.forEach(r=>{g[r.unit_kerja_id]||(g[r.unit_kerja_id]=r.unit_kerja),n.push(r.abk,r.eksisting,r.kebutuhan_pegawai)}),N.push(n)}const E=b.book_new(),f={};let x=[["No","Nama Jabatan"],["No","Nama Jabatan"],["No","Nama Jabatan"]],y=[{s:{r:0,c:0},e:{r:2,c:0}},{s:{r:0,c:1},e:{r:2,c:1}}],m=0;for(let a of Object.values(g)){const o=[a,"",""],n={s:{r:0,c:m+2},e:{r:0,c:m+4}},r=["KEPKA 182 TAHUN 2024","",""],j={s:{r:1,c:m+2},e:{r:1,c:m+4}},G=["ABK","Eksisting","Kebutuhan Pegawai"];x[0].push(...o),x[1].push(...r),x[2].push(...G),y.push(n),y.push(j),m=m+3}f["!merges"]=y,b.sheet_add_aoa(f,x),b.sheet_add_aoa(f,N,{origin:-1}),b.book_append_sheet(E,f,"abk");const W=ne(E,{bookType:"xlsx",type:"array"}),Y=new Blob([W],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),S=URL.createObjectURL(Y),d=document.createElement("a");d.href=S,d.download="data_abk.xlsx",document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(S),setOpenUnduhModal(!1)},Q=t=>{k.get(route("singkat.admin.abk"),{search:t},{replace:!0})};return e.jsxs($,{title:"User",user:c.user,children:[K.success&&e.jsx(u,{tipe:"success",pesan:K.success}),s.abk&&e.jsx(u,{tipe:"error",pesan:s.abk}),s.jabatan&&e.jsx(u,{tipe:"error",pesan:s.jabatan}),s.unit_kerja&&e.jsx(u,{tipe:"error",pesan:s.unit_kerja}),s.eksisting&&e.jsx(u,{tipe:"error",pesan:s.eksisting}),e.jsx(Z,{title:c.user.role=="viewer"?"ABK":"Kelola ABK"}),e.jsx(ee,{pageName:c.user.role=="viewer"?"ABK":"Kelola ABK"}),D,e.jsxs("div",{className:"flex flex-row sm:justify-between mb-5",children:[e.jsx(te,{initialQuery:w,handleSearch:Q}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>z(w),type:"button",className:"inline-flex items-center justify-center gap-2.5 rounded-md bg-primary py-2 px-5 text-center font-medium text-white hover:bg-opacity-90 lg:px-8 xl:px-5 mr-4",children:[e.jsx("span",{children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"size-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})})}),"Unduh Data"]}),["operator"].includes(c.user.role)&&e.jsx("button",{onClick:F,className:" gap-2.5 rounded-md    inline-flex items-center justify-center bg-meta-3 py-2 px-5  text-center font-medium text-white hover:bg-opacity-90 lg:px-8 xl:px-5 mr-4",children:"Tambah ABK"})]})]}),e.jsxs("div",{className:"flex flex-col gap-10",children:[e.jsx(oe,{abk:i,onEdit:I,onDelete:q,role:c.user.role}),e.jsx(re,{links:i.links,currentPage:i.current_page,lastPage:i.last_page,from:i.from,to:i.to,total:i.total})]}),e.jsx(se,{visible:O,onCancel:P,jabatan:v,unitKerja:A,handleCreate:V,form:T}),e.jsx(ae,{visible:R,onCancel:J,handleSave:H,abk:U,jabatan:v,unitKerja:A,role:c.user.role})]})};export{Le as default};
