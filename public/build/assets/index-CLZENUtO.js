import{r as _,q as I,j as t,Y as R,a as c,y as u}from"./app-DFnwsWrs.js";import{d as i}from"./dayjs.min-DmyZntuv.js";import{u as h,w as V}from"./xlsx-YQvpTstd.js";import{A as H}from"./AuthenticatedLayout-DXhdXRqs.js";import{S as z,P as q}from"./Pagination-iqAnRRKE.js";import{B as G}from"./Breadcrumb-DJhJcPHU.js";import Q from"./TableCapaian-B_SVoUgj.js";import D from"./CapaianForm-BNLiWfBJ.js";import{F as M}from"./index-D6qsxmpK.js";import{s as W}from"./index-DKSCozep.js";import"./Header-CPa2CG7Q.js";import"./index-BbNNQxMk.js";import"./index-7Nr_NS3U.js";import"./zoom-B0W9qZb7.js";import"./button-Bz9USzm7.js";import"./index-noO_gH--.js";import"./ActionButton-CtM_w2vP.js";import"./useLocale-Bol56ME6.js";import"./index-BZT0KOT1.js";import"./index-BcJBgg6P.js";import"./PurePanel-CRgtzXFw.js";import"./index-CdkzHvRD.js";import"./BaseInput-DmJDSday.js";import"./DownOutlined-N7VHuyP1.js";import"./index-CxLqXYg-.js";import"./useForceUpdate-opBMLGgN.js";import"./DeleteOutlined-tgspDIKo.js";import"./index-Ch6NPk6K.js";import"./index-zPBp9yDv.js";import"./row-PkYKM1PI.js";const Pe=({auth:a,capaian:n,search:f,jabatan:P,unitKerja:Y})=>{const[y]=M.useForm(),[k]=M.useForm(),[r,A]=W.useMessage(),[S,b]=_.useState(!1),[K,d]=_.useState(!1),{errors:x,flash:g}=I().props;function j(e){let o=e.bulan[0],s=e.bulan[1];const l=new Date(s);l.setDate(l.getDate()+1);const m=new Date(o);return m.setDate(m.getDate()+1),e.bulan_mulai=new Date(m).toISOString().slice(0,10),e.bulan_selesai=new Date(l).toISOString().slice(0,10),e.tmt_sk=new Date(e.tmt_sk).toISOString().slice(0,10),delete e.bulan,e.file||delete e.file,e}const v=()=>{const e={pegawai_id:340011442,nomor_sk:"0428054/KPG TAHUN 2017",jenis_sk:1,angka_kredit:18.75,tmt_sk:i("2017-05-01","YYYY-MM-DD"),bulan:[i("2016-05-01","YYYY-MM-DD"),i("2017-12-01","YYYY-MM-DD")],predikat_id:1};k.setFieldsValue(e),b(!0)},C=()=>b(!1),F=e=>{const o=i(e.bulan_mulai,"YYYY-MM-DD"),s=i(e.bulan_selesai,"YYYY-MM-DD");e.bulan=[o,s],e.tmt_sk=i(e.tmt_sk,"YYYY-MM-DD"),e.predikat_id&&(e.predikat_id=Number(e.predikat_id)),e.jenis_sk&&(e.jenis_sk=Number(e.jenis_sk)),y.setFieldsValue(e),d(!0)},O=()=>d(!1),T=async e=>{try{r.open({key:"submit-form",type:"loading",content:"menghapus 1 PAK..."});const o=await c.delete(route("singkat.admin.pak.destroy",{pak:e}));r.open({key:"submit-form",type:"success",content:"1 PAK berhasil terhapus"}),d(!1)}catch{r.open({key:"submit-form",type:"error",content:"terjadi kesalahan server"})}finally{u.reload({preserveState:!0,preserveScroll:!0})}},N=e=>{const o=new URL(route("singkat.admin.pak"));o.searchParams.set("search",e),u.get(o,{replace:!0})},U=async e=>{e=j(e);const o=e.hasOwnProperty("file")?"multipart/form-data":"application/json";try{r.open({key:"submit-form",type:"loading",content:"menyimpan perubahan..."});const s=await c.post(route("singkat.admin.pak.store"),e,{headers:{"Content-Type":o}});r.open({key:"submit-form",type:"success",content:"perubahan telah disimpan"}),d(!1)}catch(s){r.open({key:"submit-form",type:"error",content:s.response.data.error})}finally{u.reload({preserveState:!0,preserveScroll:!0})}},B=async e=>{if(e=j(e),e.file===null){r.open({key:"add-form",type:"error",content:"Mohon lampirkan dokumen PAK"}),k.setFields({file:{errors:["mohon tambahkan file"]}});return}try{r.open({key:"add-form",type:"loading",content:"menambahkan PAK..."});const o=await c.post(route("singkat.admin.pak.store"),e,{headers:{"Content-Type":"multipart/form-data"}});r.open({key:"add-form",type:"success",content:"PAK sudah ditambahkan"})}catch(o){r.open({key:"add-form",type:"error",content:o.response.data.message})}finally{u.reload({preserveState:!0,preserveScroll:!0})}},E=async e=>{const{data:o}=await c.get(route("singkat.admin.pak.fetch",{search:e})),s=h.book_new(),l=h.json_to_sheet(o);h.book_append_sheet(s,l,"capaian");const m=V(s,{bookType:"xlsx",type:"array"}),L=new Blob([m],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),w=URL.createObjectURL(L),p=document.createElement("a");p.href=w,p.download="data_capaian.xlsx",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(w),setOpenUnduhModal(!1)};return t.jsxs(H,{user:a.user,children:[A,g.success&&t.jsx(Alert,{tipe:"success",pesan:g.success}),x&&Object.keys(x).length>0&&t.jsx(Alert,{tipe:"error",pesan:"Terjadi kesalahan! Silahkan cek form."}),t.jsx(R,{title:a.user.role=="viewer"?"Dokumen Penetapan Angka Kredit(PAK)":"Kelola Dokumen Penetapan Angka Kredit(PAK)"}),t.jsx(G,{pageName:a.user.role=="viewer"?"Dokumen Penetapan Angka Kredit(PAK)":"Kelola Dokumen Penetapan Angka Kredit(PAK)"}),t.jsxs("div",{className:"flex flex-row sm:justify-between mb-5",children:[t.jsx(z,{initialQuery:f,handleSearch:N}),t.jsxs("div",{children:[t.jsxs("button",{onClick:()=>E(f),type:"button",className:"inline-flex items-center justify-center gap-2.5 rounded-md bg-primary py-2 px-5 text-center font-medium text-white hover:bg-opacity-90 lg:px-8 xl:px-5 mr-4",children:[t.jsx("span",{children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"size-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})})}),"Unduh Data"]}),["operator"].includes(a.user.role)&&t.jsxs("button",{onClick:v,className:" gap-2.5 rounded-md    inline-flex items-center justify-center bg-meta-3 py-2 px-5  text-center font-medium text-white hover:bg-opacity-90 lg:px-8 xl:px-5 mr-4",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:t.jsx("path",{fill:"currentColor",d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"})}),"Tambah PAK"]})]})]}),t.jsxs("div",{className:"flex flex-col gap-10",children:[t.jsx(Q,{capaian:n,onEdit:F,onDelete:T,role:a.user.role}),t.jsx(q,{links:n.links,currentPage:n.current_page,lastPage:n.last_page,total:n.total,from:n.from,to:n.to})]}),t.jsx(D,{jabatan:P,onFinish:B,form:k,unitKerja:Y,visible:S,onCancel:C,role:a.user.role,type:"daftar",title:"Tambah Capaian Pegawai"}),t.jsx(D,{visible:K,onCancel:O,onFinish:U,form:y,title:"Ubah Capaian Pegawai",okText:"Simpan",type:"edit"})]})};export{Pe as default};
