import{r as D,q as I,j as t,Y as R,a as d,y as k}from"./app-qozg50Md.js";import{d as h}from"./dayjs.min-kBRJ-rpy.js";import{u as y,w as V}from"./xlsx-YQvpTstd.js";import{A as z}from"./AuthenticatedLayout-Dj4ZOn3L.js";import{S as H,P as q}from"./Pagination-DJc09OSr.js";import{B as Q}from"./Breadcrumb-Df9cuyMT.js";import W from"./Table-CJvKRkrq.js";import P from"./PAKForm-BOI0HRXP.js";import{F as A}from"./index-aOYu-vQh.js";import{s as G}from"./index-3LLh_nqc.js";import"./Header-Cns69jfE.js";import"./index-CJyQPicH.js";import"./warning-Bf_VSDRp.js";import"./zoom-DM4q-JEj.js";import"./index-Cl5Xqjrl.js";import"./button-Bf_he-TK.js";import"./AntdIcon-oE3BgIqN.js";import"./index-DgYSkqUS.js";import"./ActionButton-CVruMRtK.js";import"./useLocale-BH1iDomU.js";import"./index-B-kb_xka.js";import"./index-xlaZMbuE.js";import"./PurePanel-CDwIu1rJ.js";import"./index-DTsYXN2-.js";import"./index-DC3t1Uft.js";import"./EyeOutlined-BduE5REH.js";import"./DownOutlined-DKhpsX0H.js";import"./index-BSk5wdO_.js";import"./useForceUpdate-T1gnXHnz.js";import"./DeleteOutlined-CEg6mrcj.js";import"./index-DZ7bMjgQ.js";import"./row-D3mj2rtc.js";const Se=({auth:a,capaian:n,search:g,jabatan:M,unitKerja:S})=>{const[c]=A.useForm(),[f]=A.useForm(),[s,K]=G.useMessage(),[v,x]=D.useState(!1),[F,u]=D.useState(!1),{errors:b,flash:w}=I().props;function j(e){let o=e.bulan[0],r=e.bulan[1];const i=new Date(r);i.setDate(i.getDate()+1);const l=new Date(o);l.setDate(l.getDate()+1);const m=new Date(e.tmt_sk);return m.setDate(m.getDate()+1),e.bulan_mulai=new Date(l).toISOString().slice(0,10),e.bulan_selesai=new Date(i).toISOString().slice(0,10),e.tmt_sk=new Date(m).toISOString().slice(0,10),delete e.bulan,e.file||delete e.file,e}const Y=()=>{f.resetFields(),x(!0)},C=()=>x(!1),O=e=>{c.resetFields();const o=h(e.bulan_mulai,"YYYY-MM-DD"),r=h(e.bulan_selesai,"YYYY-MM-DD");e.bulan=[o,r],e.tmt_sk=h(e.tmt_sk,"YYYY-MM-DD"),e.predikat_id&&(e.predikat_id=Number(e.predikat_id)),e.jenis_sk&&(e.jenis_sk=Number(e.jenis_sk)),e.pegawai_id=String(e.pegawai_id),c.setFieldsValue(e),u(!0)},T=()=>u(!1),B=async e=>{try{s.open({key:"submit-form",type:"loading",content:"menghapus 1 PAK..."});const o=await d.delete(route("singkat.admin.pak.destroy",{pak:e,_token:c.getFieldValue("_token")}));s.open({key:"submit-form",type:"success",content:"1 PAK berhasil terhapus"}),u(!1)}catch{s.open({key:"submit-form",type:"error",content:"terjadi kesalahan server"})}finally{k.reload({preserveState:!0,preserveScroll:!0})}},E=e=>{const o=new URL(route("singkat.admin.pak"));o.searchParams.set("search",e),k.get(o,{replace:!0})},L=async e=>{e=j(e);const o=e.hasOwnProperty("file")?"multipart/form-data":"application/json";try{s.open({key:"submit-form",type:"loading",content:"menyimpan perubahan..."});const{data:r}=await d.get(route("api.token.csrf")),i=await d.post(route("singkat.admin.pak.update",{pak:e.id}),{...e,_token:r},{headers:{"Content-Type":o}});s.open({key:"submit-form",type:"success",content:"perubahan telah disimpan"}),u(!1)}catch(r){console.log(r),s.open({key:"submit-form",type:"error",content:r.response.data.error})}finally{k.reload({preserveState:!0,preserveScroll:!0})}},N=async e=>{if(e=j(e),e.file===null){s.open({key:"add-form",type:"error",content:"Mohon lampirkan dokumen PAK"}),f.setFields({file:{errors:["mohon tambahkan file"]}});return}try{s.open({key:"add-form",type:"loading",content:"menambahkan PAK..."});const o=await d.post(route("singkat.admin.pak.store"),e,{headers:{"Content-Type":"multipart/form-data"}});s.open({key:"add-form",type:"success",content:"PAK sudah ditambahkan"})}catch(o){s.open({key:"add-form",type:"error",content:o.response.data.message})}finally{k.reload({preserveState:!0,preserveScroll:!0})}},U=async e=>{const{data:o}=await d.get(route("singkat.admin.pak.fetch",{search:e})),r=y.book_new(),i=y.json_to_sheet(o);y.book_append_sheet(r,i,"capaian");const l=V(r,{bookType:"xlsx",type:"array"}),m=new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),_=URL.createObjectURL(m),p=document.createElement("a");p.href=_,p.download="data_capaian.xlsx",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(_),setOpenUnduhModal(!1)};return t.jsxs(z,{user:a.user,children:[K,w.success&&t.jsx(Alert,{tipe:"success",pesan:w.success}),b&&Object.keys(b).length>0&&t.jsx(Alert,{tipe:"error",pesan:"Terjadi kesalahan! Silahkan cek form."}),t.jsx(R,{title:a.user.role=="viewer"?"Dokumen Penetapan Angka Kredit(PAK)":"Kelola Dokumen Penetapan Angka Kredit(PAK)"}),t.jsx(Q,{pageName:a.user.role=="viewer"?"Dokumen Penetapan Angka Kredit(PAK)":"Kelola Dokumen Penetapan Angka Kredit(PAK)"}),t.jsxs("div",{className:"flex flex-row sm:justify-between mb-5",children:[t.jsx(H,{initialQuery:g,handleSearch:E}),t.jsxs("div",{children:[t.jsxs("button",{onClick:()=>U(g),type:"button",className:"inline-flex items-center justify-center gap-2.5 rounded-md bg-primary py-2 px-5 text-center font-medium text-white hover:bg-opacity-90 lg:px-8 xl:px-5 mr-4",children:[t.jsx("span",{children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"size-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})})}),"Unduh Data"]}),["operator"].includes(a.user.role)&&t.jsxs("button",{onClick:Y,className:" gap-2.5 rounded-md    inline-flex items-center justify-center bg-meta-3 py-2 px-5  text-center font-medium text-white hover:bg-opacity-90 lg:px-8 xl:px-5 mr-4",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:t.jsx("path",{fill:"currentColor",d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"})}),"Tambah PAK"]})]})]}),t.jsxs("div",{className:"flex flex-col gap-10",children:[t.jsx(W,{capaian:n,onEdit:O,onDelete:B,role:a.user.role}),t.jsx(q,{links:n.links,currentPage:n.current_page,lastPage:n.last_page,total:n.total,from:n.from,to:n.to})]}),t.jsx(P,{jabatan:M,onFinish:N,form:f,unitKerja:S,visible:v,onCancel:C,role:a.user.role,type:"daftar",title:"Tambah Capaian Pegawai"}),t.jsx(P,{visible:F,onCancel:T,onFinish:L,form:c,title:"Ubah Capaian Pegawai",okText:"Simpan",type:"edit"})]})};export{Se as default};
