import{r as p,q as B,j as e,Y as U,a as u,y as n}from"./app-BKJY4YWz.js";import{A as V}from"./AuthenticatedLayout-CJgoqSmC.js";import{B as Y,S as R,P as q}from"./Pagination-DQDND7Ex.js";import z from"./ExportModal-NC0F4aZP.js";import H from"./TableCapaian-C75NhAsk.js";import k from"./CapaianForm-iE5cM8NS.js";import{d as Q}from"./dayjs.min-cyMN-Kl5.js";import{F as g}from"./index-fnTQ2R4P.js";import{s as W}from"./index-CIfUaNQx.js";import"./index-CYwRI9iO.js";import"./index-BWEEZemA.js";import"./zoom-j3DgVdf6.js";import"./motion-Db2xci-V.js";import"./PurePanel-BwRILxwh.js";import"./useLocale-L6Wt6RyJ.js";import"./index-DQFAOCkZ.js";import"./row-ZHVTgW77.js";import"./index-Itt_kyJq.js";import"./index-CF2UqtEp.js";import"./index-CHILXjkW.js";import"./index-DpbQZBri.js";import"./index-DWJMk0Vo.js";import"./index-C5fZKDoR.js";import"./BaseInput-CvXDMhyo.js";import"./SearchOutlined-M6lAbnbo.js";import"./index-DoEnEz9a.js";import"./index-CqrgvYV7.js";const ve=({auth:o,capaian:s,search:b,jabatan:j,unitKerja:w})=>{const[h]=g.useForm(),[v]=g.useForm(),[r,C]=W.useMessage(),[M,m]=p.useState(!1),[S,c]=p.useState(!1),[l,E]=p.useState(null),[F,f]=p.useState(!1),{errors:x,flash:y}=B().props,P=()=>m(!0),A=()=>m(!1),K=()=>f(!0),T=()=>f(!1),O=t=>{E(t),c(!0)},D=()=>c(!1),N=async t=>{try{r.open({key:"submit-form",type:"loading",content:"menghapus 1 capaian..."});const a=await u.delete(`/capaian/${t}`);r.open({key:"submit-form",type:"success",content:"1 capaian berhasil terhapus"}),c(!1)}catch{r.open({key:"submit-form",type:"error",content:"terjadi kesalahan server"})}finally{n.get("/kelola-ckp",{},{preserveState:!0})}},_=t=>{const a=new URL("http://localhost:8000/kelola-ckp");a.searchParams.set("search",t),n.get(a,{replace:!0})},$=async t=>{try{r.open({key:"submit-form",type:"loading",content:"menyimpan capaian pegawai"});let d=`${new Date(t.tahun).getFullYear()}`;const i={...t};i.tahun=d;const L=await u.patch(`/capaian/${t.id}`,i,{headers:{"Content-Type":"application/json"}});r.open({key:"submit-form",type:"success",content:"perubahan telah disimpan"}),n.get("/kelola-ckp",{},{preserveState:!0}),c(!1)}catch(a){r.open({key:"submit-form",type:"error",content:a.response.data.error})}finally{n.get("/kelola-ckp",{},{preserveState:!0})}},I=async t=>{try{r.open({key:"add-form",type:"loading",content:"menambahkan capaian pegawai"});let d=`${new Date(t.tahun).getFullYear()}`;const i={...t};i.tahun=d;const L=await u.post("/capaian",i,{headers:{"Content-Type":"application/json"}});r.open({key:"add-form",type:"success",content:"perubahan telah disimpan"}),n.get("/kelola-ckp",{},{preserveState:!0})}catch(a){r.open({key:"add-form",type:"error",content:a.response.data.error})}finally{n.get("/kelola-ckp",{},{preserveState:!0}),m(!1)}};return p.useEffect(()=>{if(!l)return;let t={...l};t.tahun=Q(new Date(`${l.tahun}-01-01`)),h.setFieldsValue(t)},[l]),e.jsxs(V,{user:o.user,children:[C,y.success&&e.jsx(Alert,{tipe:"success",pesan:y.success}),x&&Object.keys(x).length>0&&e.jsx(Alert,{tipe:"error",pesan:"Terjadi kesalahan! Silahkan cek form."}),e.jsx(U,{title:o.user.role=="viewer"?"CKP":"Kelola CKP"}),e.jsx(Y,{pageName:o.user.role=="viewer"?"CKP":"Kelola CKP"}),e.jsxs("div",{className:"flex flex-row sm:justify-between mb-5",children:[e.jsx(R,{initialQuery:b,handleSearch:_}),e.jsxs("div",{children:[e.jsxs("button",{onClick:K,type:"button",className:"inline-flex items-center justify-center gap-2.5 rounded-md bg-primary py-2 px-5 text-center font-medium text-white hover:bg-opacity-90 lg:px-8 xl:px-5 mr-4",children:[e.jsx("span",{children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"size-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})})}),"Unduh Data"]}),(o.user.role==="admin"||o.user.role==="super admin")&&e.jsx("button",{onClick:P,className:" gap-2.5 rounded-md    inline-flex items-center justify-center bg-meta-3 py-2 px-5  text-center font-medium text-white hover:bg-opacity-90 lg:px-8 xl:px-5 mr-4",children:"Tambah capaian"})]})]}),e.jsxs("div",{className:"flex flex-col gap-10",children:[e.jsx(H,{capaian:s,onEdit:O,onDelete:N,role:o.user.role}),e.jsx(q,{links:s.links,currentPage:s.current_page,lastPage:s.last_page,total:s.total,from:s.from,to:s.to})]}),e.jsx(k,{jabatan:j,onFinish:I,form:v,unitKerja:w,visible:M,onCancel:A,role:o.user.role,type:"daftar"}),e.jsx(k,{visible:S,onCancel:D,capaian:l,onFinish:$,form:h,title:"Ubah CKP",okText:"Simpan",type:"edit"}),e.jsx(z,{visible:F,onCancel:T})]})};export{ve as default};
